{% set pricesAmount = shopCart.pricesAmount %}
<div id="shopCartPopup" class="shop-cart-popup" title="{{ 'shop.cart.popup.title'|trans({}, 'ShopCatalogBundle') }}">

    {#@TODO jQuery ui dialog focus bug fix#}
    <span class="ui-helper-hidden-accessible"><input type="text"/></span>

    {% if pricesAmount > 0 %}

        <div class="shop-cart">
            {% for categoryData in shopCart.categories %}
                <div class="shop-cart-category">
                    <a href="{{ path('shop_catalog_category', { 'slug' : categoryData.category.slug }) }}">
                        {{ categoryData.category.name }}
                    </a>
                </div>
                <div class="shop-cart-proposals">
                    {% for proposalData in categoryData.proposals %}
                        <div class="shop-cart-proposal">
                            <table class="proposal-prices-table">
                                <tbody>
                                    {% for priceData in proposalData.prices %}
                                        <tr>
                                            <td class="image-cell">
                                                <div class="proposal-image">
                                                    <img src="{% path proposalData.proposal.image, 'tiny_square' %}" alt="{{ proposalData.proposal.name }}" title="{{ proposalData.proposal.name }}">
                                                </div>
                                            </td>
                                            <td class="caption-cell">
                                                <div class="proposal-name">
                                                    <a href="{{ shop_catalog_proposal_url(proposalData.proposal) }}">
                                                        {{ proposalData.proposal.title }}
                                                    </a>
                                                </div>
                                                <div class="price-description">
                                                    {{ priceData.price.description|raw }}
                                                </div>
                                            </td>
                                            <td class="price-cell">
                                                {{ 'shop.cart.price'|trans({}, 'ShopCatalogBundle') }}:
                                                <div class="price">
                                                    {{ priceData.value|weasty_price }}
                                                </div>
                                            </td>
                                            <td class="amount-cell">

                                                <div class="amount-spinner">

                                                    <a href="{{ path('shop_cart_popup') }}" class="minus {{ priceData.amount == 1 ? 'remove-from-cart' : 'decrease-amount-in-cart' }}"  data-cart='{"categoryId":{{ proposalData.proposal.categoryId }},"proposalId":{{ proposalData.proposal.id }},"priceId":{{ priceData.price.id }}}'>
                                                        -1
                                                    </a>

                                                    <div class="amount">
                                                        {{ priceData.amount }}
                                                    </div>

                                                    <a href="{{ path('shop_cart_popup') }}" class="plus increment-amount-in-cart" data-cart='{"categoryId":{{ proposalData.proposal.categoryId }},"proposalId":{{ proposalData.proposal.id }},"priceId":{{ priceData.price.id }}}'>
                                                        +1
                                                    </a>

                                                </div>

                                            </td>
                                            <td class="summary-price-cell">
                                                {{ 'shop.cart.summary'|trans({}, 'ShopCatalogBundle') }}:
                                                <div class="summary-price">
                                                    {% if priceData.amount > 1 %}
                                                        {{ priceData.summary|weasty_price }}
                                                    {% else %}
                                                        {{ priceData.value|weasty_price }}
                                                    {% endif %}
                                                </div>
                                            </td>
                                            <td class="buttons-cell">
                                                <a href="{{ path('shop_cart_popup') }}" class="remove-from-cart" data-cart='{"categoryId":{{ proposalData.proposal.categoryId }},"proposalId":{{ proposalData.proposal.id }},"priceId":{{ priceData.price.id }}}'>
                                                    {{ 'shop.cart.remove.proposal'|trans({}, 'ShopCatalogBundle') }}
                                                </a>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>

    {% endif %}

    <div class="shop-cart-summary">
        {{ 'shop.cart.summary.price'|transchoice(pricesAmount, {
        '%summary_price%' : shopCart.summaryPrice.value|weasty_price
        }, 'ShopCatalogBundle') }}
    </div>

    <div class="ui-buttons hidden-preview">
        <div class="large secondary btn">
            <a href="#" class="dialog-close-btn">
                {{ 'shop.cart.to_catalog'|trans({}, 'ShopCatalogBundle') }}
            </a>
        </div>
        {% if pricesAmount > 0 %}
            <div class="large secondary btn">
                <a href="{{ path('shop_cart') }}">
                    {{ 'shop.cart.create.order'|trans({}, 'ShopCatalogBundle') }}
                </a>
            </div>
        {% endif %}
    </div>

</div>