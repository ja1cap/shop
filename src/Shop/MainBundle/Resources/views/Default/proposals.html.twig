{% extends 'ShopMainBundle:Default:layout.html.twig' %}
{% block title %}{{ page.seoTitle|default(category.name) }}{% endblock %}
{% block description %}{{ page.seoDescription|default(category.name) }}{% endblock %}
{% block keywords %}{{ page.seoKeywords|default(category.name) }}{% endblock %}
{% block main_container %}
    <div class="row well-v">
        <div class="three columns">
            {% block proposals_left_bar %}
                {{ include('ShopMainBundle:Default:proposals-left-bar.html.twig') }}
                {% if extraParametersData %}
                    <div class="filters-form-container extraFiltersForm-container">
                        <div class="title">
                            Дополнительные фильтры
                        </div>
                        <form id="extraFiltersForm" class="extraFiltersForm">
                            {% for parameterData in extraParametersData %}
                                <div class="proposal-select">
                                    <label for="parameter_{{ parameterData.parameter.id }}">
                                        {{ parameterData.parameter.name }}
                                    </label>
                                    <div class="picker">
                                        <select id="parameter_{{ parameterData.parameter.id }}" name="parameters[{{ parameterData.parameter.id }}]">
                                            <option value="">Не важно</option>
                                            {% for option in parameterData.options %}
                                                <option value="{{ option.id }}" {{ filteredParameterValues[parameterData.parameter.id] == option.id ? "selected='selected'" : "" }}>
                                                    {{ option.name }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            {% endfor %}
                        </form>
                    </div>
                {% endif %}
            {% endblock %}
        </div>
        <div class="nine columns">
            {% block proposals_right_bar %}
                {% if parametersData or (manufacturers and manufacturers|length > 1) %}
                    <div class="">
                        <div class="filters-form-container">
                            <div class="title">
                                Подбор {{ category.singular_genitive_name }}
                            </div>
                            <form id="filtersForm" class="mainFiltersForm">
                                <ul class="tiles three_up">
                                    {% if manufacturers and manufacturers|length > 1 %}
                                        <li>
                                            <div class="proposal-select">
                                                <label for="manufacturers">
                                                    Производитель
                                                </label>
                                                <div class="picker">
                                                    <select id="manufacturers" name="manufacturer">
                                                        <option value="">Не важно</option>
                                                        {% for manufacturer in manufacturers %}
                                                            <option value="{{ manufacturer.id }}" {{ filteredManufacturer == manufacturer.id ? "selected='selected'" : "" }}>
                                                                {{ manufacturer.name }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </li>
                                    {% endif %}
                                    {% for parameterData in parametersData %}
                                        <li>
                                            <div class="proposal-select">
                                                <label for="parameter_{{ parameterData.parameter.id }}">
                                                    {{ parameterData.parameter.name }}
                                                </label>
                                                <div class="picker">
                                                    <select id="parameter_{{ parameterData.parameter.id }}" name="parameters[{{ parameterData.parameter.id }}]">
                                                        <option value="">Не важно</option>
                                                        {% for option in parameterData.options %}
                                                            <option value="{{ option.id }}" {{ filteredParameterValues[parameterData.parameter.id] == option.id ? "selected='selected'" : "" }}>
                                                                {{ option.name }}
                                                            </option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </form>
                        </div>
                    </div>
                {% endif %}
                <ul class="proposals-list tiles three_up">
                    {% for proposal_data in proposals %}

                        <li class="proposal">

                            {% set proposal = proposal_data.proposal %}

                            <a href="{{ path('shop_proposal', { 'categorySlug' : category.slug, 'slug' : proposal.seoSlug|default(proposal.id) }) }}" class="proposal-fancybox inner-container" data-fancybox-type="ajax" rel="proposals">

                                <span class="image-container">
                                    <span class="nailthumb-container">
                                        <img src="{{ proposal.thumb_image_url|default(proposal.image_url) }}">
                                    </span>
                                </span>

                                <span class="title">
                                    {{ proposal.title|nl2br }}
                                </span>

                                <span class="description">
                                    {{ proposal.short_description|nl2br }}
                                </span>

                                <span class="price">
                                    {{ proposal_data.price|number_format(0, '.', ' ') }} руб
                                </span>

                            </a>

                        </li>

                    {% endfor %}

                </ul>
            {% endblock %}
            {{ page.content|nl2br }}
        </div>
    </div>
    <script>
        $(function(){

            var $filtersForm = $('#filtersForm, #extraFiltersForm');

            var categoryUrl = '{{ path('shop_category', {'slug' : category.slug}) }}';

            $(':input', $filtersForm).change(function(){

                document.location = categoryUrl + '?' +$filtersForm.serialize();

            });

        });
    </script>
{% endblock %}